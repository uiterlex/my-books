<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Book Collection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        h1 {
            font-size: 2rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        .stats {
            color: #666;
            margin-top: 0.5rem;
        }

        .auth-section {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .auth-btn, .add-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .auth-btn {
            background: #e5e5e5;
            color: #333;
        }

        .auth-btn:hover {
            background: #d5d5d5;
        }

        .add-btn {
            background: #2563eb;
            color: white;
        }

        .add-btn:hover {
            background: #1d4ed8;
        }

        .hidden {
            display: none !important;
        }

        .book-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .book-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            gap: 1.25rem;
            position: relative;
        }

        .book-cover {
            width: 80px;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
            background: #e5e5e5;
            flex-shrink: 0;
        }

        .book-cover-placeholder {
            width: 80px;
            height: 120px;
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #6366f1;
            flex-shrink: 0;
        }

        .book-info {
            flex: 1;
            min-width: 0;
        }

        .book-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .book-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 0.25rem;
        }

        .book-author {
            color: #666;
            margin-bottom: 0.75rem;
        }

        .book-meta {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .book-meta span {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            color: #555;
        }

        .stars {
            color: #f59e0b;
            letter-spacing: 1px;
        }

        /* Updated series styling - no colored background */
        .series {
            color: #666;
            font-size: 0.9rem;
            font-style: italic;
        }

        .category {
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .category-thriller {
            background: #fee2e2;
            color: #991b1b;
        }

        .category-detective {
            background: #dbeafe;
            color: #1e40af;
        }

        .category-other {
            background: #f3f4f6;
            color: #374151;
        }

        .book-dates {
            font-size: 0.85rem;
            color: #888;
            margin-top: 0.5rem;
        }

        .book-actions {
            display: flex;
            gap: 0.5rem;
        }

        .edit-btn, .delete-btn {
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .edit-btn {
            background: #f3f4f6;
            color: #374151;
        }

        .delete-btn {
            background: #fee2e2;
            color: #991b1b;
        }

        .preview-btn, .plot-btn {
            background: none;
            border: 1px solid #ddd;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            color: #666;
        }

        .preview-btn:hover, .plot-btn:hover {
            background: #f5f5f5;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            font-size: 1.25rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .btn-cancel {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-save {
            padding: 0.5rem 1rem;
            border: none;
            background: #2563eb;
            color: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-delete {
            padding: 0.5rem 1rem;
            border: none;
            background: #dc2626;
            color: white;
            border-radius: 6px;
            cursor: pointer;
        }

        /* Image upload styles */
        .image-upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .image-upload-area:hover {
            border-color: #2563eb;
        }

        .image-upload-area.has-image {
            border-style: solid;
            border-color: #10b981;
        }

        .image-preview {
            max-width: 120px;
            max-height: 180px;
            object-fit: cover;
            border-radius: 4px;
            margin-top: 0.5rem;
        }

        .image-upload-text {
            color: #666;
            font-size: 0.9rem;
        }

        .image-upload-area input[type="file"] {
            display: none;
        }

        .remove-image-btn {
            margin-top: 0.5rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            background: #fee2e2;
            color: #991b1b;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .loading-text {
            text-align: center;
            color: #666;
            padding: 2rem;
        }

        @media (max-width: 600px) {
            body {
                padding: 1rem;
            }

            .book-card {
                flex-direction: column;
            }

            .book-cover, .book-cover-placeholder {
                width: 60px;
                height: 90px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>ðŸ“š My Book Collection</h1>
                <p class="stats" id="stats">Loading...</p>
            </div>
            <div class="auth-section">
                <button class="add-btn hidden" id="addBtn">+ Add Book</button>
                <button class="auth-btn" id="signInBtn">Sign In</button>
                <button class="auth-btn hidden" id="signOutBtn">Sign Out</button>
            </div>
        </header>

        <div class="book-list" id="bookList">
            <p class="loading-text">Loading books...</p>
        </div>
    </div>

    <!-- Text Modal (for preview/plot) -->
    <div class="modal" id="textModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="textModalTitle">Title</h2>
                <button class="close-btn" onclick="closeTextModal()">Ã—</button>
            </div>
            <p id="textModalContent">Content</p>
        </div>
    </div>

    <!-- Add/Edit Book Modal -->
    <div class="modal" id="bookModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Book</h2>
                <button class="close-btn" onclick="closeBookModal()">Ã—</button>
            </div>
            <form id="bookForm">
                <input type="hidden" id="bookId">
                
                <!-- Image Upload -->
                <div class="form-group">
                    <label>Cover Image</label>
                    <div class="image-upload-area" id="imageUploadArea" onclick="document.getElementById('coverImage').click()">
                        <input type="file" id="coverImage" accept="image/*" onchange="handleImageSelect(event)">
                        <div id="imagePreviewContainer">
                            <p class="image-upload-text">ðŸ“· Click to upload cover image<br><small>(will be resized to max 300px)</small></p>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Title *</label>
                    <input type="text" id="title" required>
                </div>

                <div class="form-group">
                    <label>Author *</label>
                    <input type="text" id="author" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Pages</label>
                        <input type="number" id="pages">
                    </div>
                    <div class="form-group">
                        <label>Rating</label>
                        <select id="rating">
                            <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
                            <option value="4">â˜…â˜…â˜…â˜…â˜†</option>
                            <option value="3">â˜…â˜…â˜…â˜†â˜†</option>
                            <option value="2">â˜…â˜…â˜†â˜†â˜†</option>
                            <option value="1">â˜…â˜†â˜†â˜†â˜†</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Series</label>
                    <input type="text" id="series" placeholder="e.g. Robert Langdon serie">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="category">
                            <option value="">-- Select --</option>
                            <option value="thriller">Thriller</option>
                            <option value="detective">Detective</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>First Edition (year)</label>
                        <input type="text" id="firstEdition" maxlength="4" placeholder="YYYY">
                    </div>
                </div>

                <div class="form-group">
                    <label>Date Read</label>
                    <input type="month" id="dateRead">
                </div>

                <div class="form-group">
                    <label>Preview</label>
                    <textarea id="preview" placeholder="Short preview or teaser..."></textarea>
                </div>

                <div class="form-group">
                    <label>Plot</label>
                    <textarea id="plot" placeholder="Plot summary..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeBookModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Delete Book</h2>
                <button class="close-btn" onclick="closeDeleteModal()">Ã—</button>
            </div>
            <p>Are you sure you want to delete this book?</p>
            <div class="form-actions">
                <button class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn-delete" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        import { getAuth, signInWithPopup, signOut, onAuthStateChanged, GoogleAuthProvider } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC7oDuArIH_LMQbSyKE8k1g0m3n_fa1NH8",
            authDomain: "my-books-4ef15.firebaseapp.com",
            projectId: "my-books-4ef15",
            storageBucket: "my-books-4ef15.firebasestorage.app",
            messagingSenderId: "920189621468",
            appId: "1:920189621468:web:101a4c439e8e3cbd18d019",
            measurementId: "G-04FBFW09HS"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);
        const provider = new GoogleAuthProvider();

        const OWNER_EMAIL = 'uiterlex@gmail.com';
        let currentUser = null;
        let isOwner = false;
        let books = [];
        let editingBookId = null;
        let pendingImageFile = null;
        let currentImageUrl = null;

        // DOM elements
        const bookList = document.getElementById('bookList');
        const stats = document.getElementById('stats');
        const signInBtn = document.getElementById('signInBtn');
        const signOutBtn = document.getElementById('signOutBtn');
        const addBtn = document.getElementById('addBtn');
        const bookModal = document.getElementById('bookModal');
        const bookForm = document.getElementById('bookForm');
        const textModal = document.getElementById('textModal');
        const deleteModal = document.getElementById('deleteModal');

        // Auth state listener
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            isOwner = user && user.email === OWNER_EMAIL;
            updateAuthUI();
            renderBooks();
        });

        function updateAuthUI() {
            signInBtn.classList.toggle('hidden', currentUser !== null);
            signOutBtn.classList.toggle('hidden', currentUser === null);
            addBtn.classList.toggle('hidden', !isOwner);
        }

        // Sign in/out handlers
        signInBtn.addEventListener('click', () => {
            signInWithPopup(auth, provider).catch(err => console.error('Sign in error:', err));
        });

        signOutBtn.addEventListener('click', () => {
            signOut(auth).catch(err => console.error('Sign out error:', err));
        });

        // Load books with real-time updates
        const booksQuery = query(collection(db, 'books'), orderBy('dateRead', 'desc'));
        onSnapshot(booksQuery, (snapshot) => {
            books = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderBooks();
            updateStats();
        });

        function updateStats() {
            const totalPages = books.reduce((sum, book) => sum + (book.pages || 0), 0);
            stats.textContent = `${books.length} book${books.length !== 1 ? 's' : ''} read Â· ${totalPages.toLocaleString()} pages`;
        }

        function renderStars(rating) {
            const filled = 'â˜…'.repeat(rating || 0);
            const empty = 'â˜†'.repeat(5 - (rating || 0));
            return filled + empty;
        }

        function renderBooks() {
            if (books.length === 0) {
                bookList.innerHTML = '<p class="loading-text">No books yet. Add your first book!</p>';
                return;
            }

            bookList.innerHTML = books.map(book => `
                <article class="book-card">
                    ${book.coverUrl 
                        ? `<img src="${book.coverUrl}" alt="${book.title}" class="book-cover">`
                        : `<div class="book-cover-placeholder">ðŸ“–</div>`
                    }
                    <div class="book-info">
                        <div class="book-header">
                            <div>
                                <h2 class="book-title">${book.title}</h2>
                                <p class="book-author">${book.author}</p>
                            </div>
                            ${isOwner ? `
                                <div class="book-actions">
                                    <button class="edit-btn" onclick="window.editBook('${book.id}')">Edit</button>
                                    <button class="delete-btn" onclick="window.confirmDelete('${book.id}')">Delete</button>
                                </div>
                            ` : ''}
                        </div>
                        <div class="book-meta">
                            <span class="stars">${renderStars(book.rating)}</span>
                            ${book.pages ? `<span>ðŸ“„ ${book.pages} pages</span>` : ''}
                            ${book.category ? `<span class="category category-${book.category}">${book.category}</span>` : ''}
                        </div>
                        ${book.series ? `<p class="series">Series: ${book.series}</p>` : ''}
                        <div class="book-meta">
                            ${book.preview ? `<button class="preview-btn" onclick="window.showText('Preview', \`${book.preview.replace(/`/g, '\\`')}\`)">Preview</button>` : ''}
                            ${book.plot ? `<button class="plot-btn" onclick="window.showText('Plot', \`${book.plot.replace(/`/g, '\\`')}\`)">Plot</button>` : ''}
                        </div>
                        ${book.dateRead || book.firstEdition ? `
                            <p class="book-dates">
                                ${book.dateRead ? `Read: ${formatDate(book.dateRead)}` : ''}
                                ${book.dateRead && book.firstEdition ? ' Â· ' : ''}
                                ${book.firstEdition ? `First edition: ${book.firstEdition}` : ''}
                            </p>
                        ` : ''}
                    </div>
                </article>
            `).join('');
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const [year, month] = dateStr.split('-');
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${months[parseInt(month) - 1]} ${year}`;
        }

        // Image handling
        window.handleImageSelect = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Resize image before storing
            resizeImage(file, 300, 450).then(resizedBlob => {
                pendingImageFile = resizedBlob;
                showImagePreview(URL.createObjectURL(resizedBlob));
            });
        };

        function resizeImage(file, maxWidth, maxHeight) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    let { width, height } = img;
                    
                    // Calculate new dimensions maintaining aspect ratio
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width = Math.round(width * ratio);
                        height = Math.round(height * ratio);
                    }

                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    canvas.toBlob(resolve, 'image/jpeg', 0.85);
                };
                img.src = URL.createObjectURL(file);
            });
        }

        function showImagePreview(url) {
            const container = document.getElementById('imagePreviewContainer');
            const uploadArea = document.getElementById('imageUploadArea');
            uploadArea.classList.add('has-image');
            container.innerHTML = `
                <img src="${url}" class="image-preview" alt="Cover preview">
                <br>
                <button type="button" class="remove-image-btn" onclick="window.removeImage(event)">Remove image</button>
            `;
        }

        window.removeImage = function(event) {
            event.stopPropagation();
            pendingImageFile = null;
            currentImageUrl = null;
            resetImageUpload();
        };

        function resetImageUpload() {
            const container = document.getElementById('imagePreviewContainer');
            const uploadArea = document.getElementById('imageUploadArea');
            uploadArea.classList.remove('has-image');
            container.innerHTML = `<p class="image-upload-text">ðŸ“· Click to upload cover image<br><small>(will be resized to max 300px)</small></p>`;
            document.getElementById('coverImage').value = '';
        }

        async function uploadImage(bookId) {
            if (!pendingImageFile) return currentImageUrl;
            
            const storageRef = ref(storage, `covers/${bookId}.jpg`);
            await uploadBytes(storageRef, pendingImageFile);
            return await getDownloadURL(storageRef);
        }

        async function deleteImage(bookId) {
            try {
                const storageRef = ref(storage, `covers/${bookId}.jpg`);
                await deleteObject(storageRef);
            } catch (e) {
                // Image might not exist, ignore error
            }
        }

        // Modal functions
        addBtn.addEventListener('click', () => openBookModal());

        function openBookModal(book = null) {
            editingBookId = book?.id || null;
            document.getElementById('modalTitle').textContent = book ? 'Edit Book' : 'Add Book';
            
            // Reset form
            bookForm.reset();
            pendingImageFile = null;
            currentImageUrl = book?.coverUrl || null;
            resetImageUpload();

            // Fill form if editing
            if (book) {
                document.getElementById('title').value = book.title || '';
                document.getElementById('author').value = book.author || '';
                document.getElementById('pages').value = book.pages || '';
                document.getElementById('rating').value = book.rating || 5;
                document.getElementById('series').value = book.series || '';
                document.getElementById('category').value = book.category || '';
                document.getElementById('firstEdition').value = book.firstEdition || '';
                document.getElementById('dateRead').value = book.dateRead || '';
                document.getElementById('preview').value = book.preview || '';
                document.getElementById('plot').value = book.plot || '';
                
                if (book.coverUrl) {
                    showImagePreview(book.coverUrl);
                }
            }

            bookModal.classList.add('active');
        }

        window.closeBookModal = function() {
            bookModal.classList.remove('active');
            editingBookId = null;
            pendingImageFile = null;
            currentImageUrl = null;
        };

        window.editBook = function(id) {
            const book = books.find(b => b.id === id);
            if (book) openBookModal(book);
        };

        // Form submission
        bookForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isOwner) return;

            const bookData = {
                title: document.getElementById('title').value.trim(),
                author: document.getElementById('author').value.trim(),
                pages: parseInt(document.getElementById('pages').value) || null,
                rating: parseInt(document.getElementById('rating').value),
                series: document.getElementById('series').value.trim() || null,
                category: document.getElementById('category').value || null,
                firstEdition: document.getElementById('firstEdition').value.trim() || null,
                dateRead: document.getElementById('dateRead').value || null,
                preview: document.getElementById('preview').value.trim() || null,
                plot: document.getElementById('plot').value.trim() || null
            };

            try {
                if (editingBookId) {
                    // Handle image: upload new, keep existing, or remove
                    if (pendingImageFile) {
                        bookData.coverUrl = await uploadImage(editingBookId);
                    } else if (currentImageUrl) {
                        bookData.coverUrl = currentImageUrl;
                    } else {
                        bookData.coverUrl = null;
                        await deleteImage(editingBookId);
                    }
                    
                    await updateDoc(doc(db, 'books', editingBookId), bookData);
                } else {
                    // Add new book first to get ID
                    const docRef = await addDoc(collection(db, 'books'), bookData);
                    
                    // Then upload image with the new ID
                    if (pendingImageFile) {
                        const coverUrl = await uploadImage(docRef.id);
                        await updateDoc(doc(db, 'books', docRef.id), { coverUrl });
                    }
                }
                
                closeBookModal();
            } catch (err) {
                console.error('Error saving book:', err);
                alert('Error saving book. Please try again.');
            }
        });

        // Delete functionality
        let deleteBookId = null;

        window.confirmDelete = function(id) {
            deleteBookId = id;
            deleteModal.classList.add('active');
        };

        window.closeDeleteModal = function() {
            deleteModal.classList.remove('active');
            deleteBookId = null;
        };

        document.getElementById('confirmDeleteBtn').addEventListener('click', async () => {
            if (!deleteBookId || !isOwner) return;
            
            try {
                await deleteImage(deleteBookId);
                await deleteDoc(doc(db, 'books', deleteBookId));
                closeDeleteModal();
            } catch (err) {
                console.error('Error deleting book:', err);
                alert('Error deleting book. Please try again.');
            }
        });

        // Text modal (preview/plot)
        window.showText = function(title, content) {
            document.getElementById('textModalTitle').textContent = title;
            document.getElementById('textModalContent').textContent = content;
            textModal.classList.add('active');
        };

        window.closeTextModal = function() {
            textModal.classList.remove('active');
        };

        // Close modals on backdrop click
        [bookModal, textModal, deleteModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Close modals on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                bookModal.classList.remove('active');
                textModal.classList.remove('active');
                deleteModal.classList.remove('active');
            }
        });
    </script>
</body>
</html>
